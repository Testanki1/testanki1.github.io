<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Library</title>
    <style>
        /* --- 1. Design Tokens (Expressive Theme) --- */
        :root {
            /* Core Colors (Violet Seed) */
            --sys-primary: #6750A4;
            --sys-on-primary: #FFFFFF;
            --sys-primary-container: #EADDFF;
            --sys-on-primary-container: #21005D;
            
            --sys-secondary: #625B71;
            --sys-secondary-container: #E8DEF8;
            --sys-on-secondary-container: #1D192B;

            --sys-surface: #FFEF7;
            --sys-surface-container-low: #F7F2FA;
            --sys-surface-container: #F3EDF7;
            --sys-surface-container-high: #ECE6F0;
            --sys-on-surface: #1D1B20;
            --sys-on-surface-variant: #49454F;
            --sys-outline: #79747E;
            --sys-outline-variant: #CAC4D0;

            --sys-inverse-surface: #313033;
            --sys-inverse-on-surface: #F4EFF4;

            /* Typography */
            --type-display: 400 32px/40px system-ui, sans-serif;
            --type-headline: 400 24px/32px system-ui, sans-serif;
            --type-label: 500 12px/16px system-ui, sans-serif;
            --type-body: 400 16px/24px system-ui, sans-serif;

            /* Shape & Spacing */
            --shape-full: 999px;
            --shape-xl: 28px;
            --shape-lg: 16px;
            --shape-md: 12px;
            
            /* Layout */
            --nav-width-desktop: 88px;
            --nav-height-mobile: 80px;
        }

        /* --- 2. Global Reset --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--sys-surface);
            color: var(--sys-on-surface);
            font-family: system-ui, -apple-system, Roboto, sans-serif;
            height: 100dvh; /* Dynamic Viewport Height */
            display: flex;
            overflow: hidden;
        }

        /* --- 3. Layout Structure (Responsive) --- */
        
        /* Desktop: Row layout (Nav Left + Main Right) */
        @media (min-width: 800px) {
            body { flex-direction: row; }
            nav {
                width: var(--nav-width-desktop);
                height: 100%;
                flex-direction: column;
                border-right: 1px solid var(--sys-outline-variant);
                border-top: none;
                padding: 24px 0;
            }
            main {
                padding: 0 48px 48px; /* Less bottom padding needed on desktop */
            }
            .app-container {
                max-width: 1200px;
                margin: 0 auto;
                width: 100%;
            }
        }

        /* Mobile: Column layout (Main Top + Nav Bottom) */
        @media (max-width: 799px) {
            body { flex-direction: column; }
            nav {
                width: 100%;
                height: var(--nav-height-mobile);
                flex-direction: row;
                bottom: 0; left: 0; position: fixed;
                border-top: 1px solid var(--sys-surface-container-high);
                background: var(--sys-surface-container);
            }
            main {
                padding: 0 16px 120px; /* More bottom padding for mobile nav */
            }
        }

        /* --- 4. Navigation (Rail/Bar) --- */
        nav {
            background: var(--sys-surface-container);
            display: flex;
            align-items: center;
            justify-content: center; /* Center items in rail/bar */
            gap: 12px;
            z-index: 50;
            flex-shrink: 0;
        }

        .nav-scroll-container {
            display: flex;
            gap: 8px;
            /* Handle overflow for both directions depending on layout */
            overflow: auto;
            scrollbar-width: none;
        }
        .nav-scroll-container::-webkit-scrollbar { display: none; }

        @media (min-width: 800px) {
            .nav-scroll-container { flex-direction: column; width: 100%; align-items: center; }
        }
        @media (max-width: 799px) {
            .nav-scroll-container { flex-direction: row; width: 100%; padding: 0 16px; align-items: center; }
        }

        .nav-item {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer;
            min-width: 56px; min-height: 56px;
            color: var(--sys-on-surface-variant);
            transition: 0.2s;
            border-radius: 16px;
        }
        
        .nav-icon-box {
            width: 56px; height: 32px;
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 14px;
            transition: 0.3s cubic-bezier(0.2, 0, 0, 1);
            margin-bottom: 4px;
        }
        
        .nav-item.active { color: var(--sys-on-surface); }
        .nav-item.active .nav-icon-box {
            background-color: var(--sys-secondary-container);
            color: var(--sys-on-secondary-container);
            width: 56px; /* Pill shape */
        }
        .nav-label {
            font: var(--type-label);
            text-align: center;
            opacity: 0.8;
        }

        /* --- 5. Main Content Area --- */
        main {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            background: var(--sys-surface);
        }

        /* Header Area */
        .top-bar {
            padding: 24px 0 16px;
            position: sticky; top: 0;
            background: rgba(255, 251, 254, 0.95); /* Semi-transparent surface */
            backdrop-filter: blur(10px);
            z-index: 40;
        }
        @media (prefers-color-scheme: dark) {
            .top-bar { background: rgba(20, 18, 24, 0.95); }
        }

        h1 {
            font: var(--type-display);
            margin: 0 0 16px 4px;
            color: var(--sys-on-surface);
        }

        /* Filter Chips */
        .chips-row {
            display: flex; gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
            scrollbar-width: none;
        }
        .chips-row::-webkit-scrollbar { display: none; }

        .chip {
            height: 32px;
            padding: 0 16px;
            border-radius: 8px;
            border: 1px solid var(--sys-outline);
            background: transparent;
            color: var(--sys-on-surface-variant);
            font: var(--type-label);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: 0.2s;
            user-select: none;
        }
        .chip:hover { background: var(--sys-surface-container-high); }
        .chip.selected {
            background: var(--sys-secondary-container);
            color: var(--sys-on-secondary-container);
            border-color: transparent;
        }
        .chip .icon { margin-right: 6px; font-size: 14px; }

        /* Emoji Groups */
        .group-section {
            margin-top: 32px;
            scroll-margin-top: 120px; /* Offset for sticky header */
        }
        .group-title {
            font: var(--type-headline);
            color: var(--sys-on-surface);
            margin-bottom: 16px;
            padding-left: 4px;
        }
        .subgroup-pill {
            display: inline-block;
            font: var(--type-label);
            color: var(--sys-primary);
            background: var(--sys-surface-container-high);
            padding: 6px 12px;
            border-radius: 8px;
            margin: 12px 0 8px;
        }

        /* Grid System */
        .emoji-grid {
            display: grid;
            /* Responsive columns: min 48px width, auto fill */
            grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }

        /* Variant Container (The "Card") */
        .variant-card {
            grid-column: 1 / -1; /* Span full width */
            background: var(--sys-surface-container-high);
            border-radius: var(--shape-lg);
            padding: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }

        .emoji-btn {
            width: 48px; height: 48px;
            font-size: 28px;
            display: flex; align-items: center; justify-content: center;
            border-radius: var(--shape-full); /* Circle hover effect */
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            user-select: none;
            position: relative;
        }
        .emoji-btn:hover { background: var(--sys-surface-container-high); }
        .variant-card .emoji-btn:hover { background: var(--sys-surface-container); } /* Darker on card */
        
        .emoji-btn:active { transform: scale(0.9); background: var(--sys-outline-variant); }

        /* Dashed Separator */
        .emoji-btn.separator { margin-right: 12px; }
        .emoji-btn.separator::after {
            content: ""; position: absolute;
            right: -10px; top: 10px; bottom: 10px;
            width: 1px; border-right: 2px dashed var(--sys-outline-variant);
        }

        /* --- 6. Overlays (Tooltip & Snackbar) --- */
        
        /* Tooltip */
        #tooltip {
            position: fixed; z-index: 2000;
            background: var(--sys-inverse-surface);
            color: var(--sys-inverse-on-surface);
            padding: 8px 16px;
            border-radius: var(--shape-md);
            font-size: 14px; text-align: center;
            pointer-events: none; opacity: 0;
            white-space: nowrap; width: max-content; max-width: 90vw;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: opacity 0.15s ease-out;
        }
        #tooltip.visible { opacity: 1; }
        .tt-main { display: block; font-weight: 600; }
        .tt-sub { display: block; font-size: 12px; opacity: 0.8; margin-top: 2px; }

        /* Snackbar */
        #snackbar {
            position: fixed; bottom: 24px; left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--sys-inverse-surface);
            color: var(--sys-inverse-on-surface);
            padding: 14px 24px;
            border-radius: var(--shape-full);
            font: var(--type-body);
            font-size: 14px;
            display: flex; align-items: center; gap: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.05, 0.7, 0.1, 1.0); /* Expressive easing */
            z-index: 3000;
        }
        #snackbar.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        /* Mobile adjustment for snackbar to be above nav */
        @media (max-width: 799px) {
            #snackbar { bottom: 100px; }
        }

        /* Loading */
        #loading {
            position: fixed; inset: 0; z-index: 5000;
            background: var(--sys-surface);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 24px; transition: opacity 0.4s;
        }
        .loader {
            width: 48px; height: 48px;
            border: 5px solid var(--sys-surface-container-high);
            border-top-color: var(--sys-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <!-- Loading State -->
    <div id="loading">
        <div class="loader"></div>
        <div style="font: var(--type-headline); color: var(--sys-primary);">Emoji Library</div>
        <div style="font: var(--type-label); color: var(--sys-outline);">Loading Unicode Data...</div>
    </div>

    <!-- Navigation (Rail on Desktop, Bottom Bar on Mobile) -->
    <nav>
        <div class="nav-scroll-container" id="nav-container">
            <!-- JS Injected -->
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-scroll">
        <div class="app-container">
            <div class="top-bar">
                <h1>Emoji Library</h1>
                <div class="chips-row" id="filter-container">
                    <!-- JS Injected -->
                </div>
            </div>
            
            <div id="content-area">
                <!-- JS Injected -->
            </div>
        </div>
    </main>

    <!-- Overlays -->
    <div id="tooltip"></div>
    <div id="snackbar"></div>

    <script>
        (function() {
            'use strict';

            const DATA_URL = 'https://www.unicode.org/Public/emoji/latest/emoji-test.txt';
            const PROXY = 'https://api.codetabs.com/v1/proxy?quest=';
            
            let rawData = {};
            let activeStatus = '';
            let isScrolling = false;
            let tooltipTimeout;

            const ui = {
                loading: document.getElementById('loading'),
                nav: document.getElementById('nav-container'),
                filters: document.getElementById('filter-container'),
                content: document.getElementById('content-area'),
                main: document.getElementById('main-scroll'),
                tooltip: document.getElementById('tooltip'),
                snackbar: document.getElementById('snackbar')
            };

            // --- Initialization ---
            async function init() {
                try {
                    const res = await fetch(PROXY + encodeURIComponent(DATA_URL));
                    if (!res.ok) throw new Error('Connection Failed');
                    const text = await res.text();
                    processText(text);
                    buildUI();
                    
                    // Smooth fade out
                    ui.loading.style.opacity = '0';
                    setTimeout(() => ui.loading.style.display = 'none', 400);
                } catch (err) {
                    ui.loading.innerHTML = `<div style="text-align:center; color:#B3261E">
                        <h3>Unable to Load</h3>
                        <p>${err.message}</p>
                    </div>`;
                }
            }

            // --- Data Processing ---
            function processText(text) {
                const lines = text.split('\n');
                let group = "Unknown", subgroup = "Unknown";

                lines.forEach(line => {
                    line = line.trim();
                    if (!line) return;
                    
                    if (line.startsWith('# group:')) group = line.split(': ')[1].trim();
                    else if (line.startsWith('# subgroup:')) subgroup = line.split(': ')[1].trim();
                    else if (!line.startsWith('#') && line.includes(';')) {
                        // Parse: 1F600 ; fully-qualified # ðŸ˜€ E1.0 grinning face
                        const [codes, meta] = line.split(';');
                        const [status, comment] = meta.split('#');
                        const cleanStatus = status.trim();
                        
                        const commentParts = comment.trim().split(' '); // [ðŸ˜€, E1.0, grinning, face]
                        const char = commentParts[0];
                        // Skip version (E1.0), join rest
                        const nameFull = commentParts.slice(2).join(' ');
                        
                        // Split Base vs Qualifier (person: red hair)
                        const [base, ...qualParts] = nameFull.split(':');
                        const qual = qualParts.join(':').trim();

                        if (!rawData[cleanStatus]) rawData[cleanStatus] = {};
                        if (!rawData[cleanStatus][group]) rawData[cleanStatus][group] = {};
                        if (!rawData[cleanStatus][group][subgroup]) rawData[cleanStatus][group][subgroup] = {};
                        if (!rawData[cleanStatus][group][subgroup][base.trim()]) rawData[cleanStatus][group][subgroup][base.trim()] = [];

                        rawData[cleanStatus][group][subgroup][base.trim()].push({
                            char, base: base.trim(), qual
                        });
                    }
                });
            }

            // --- UI Building ---
            function buildUI() {
                const statuses = Object.keys(rawData);
                if (!statuses.length) return;
                
                // Priority: fully-qualified -> first available
                activeStatus = statuses.includes('fully-qualified') ? 'fully-qualified' : statuses[0];

                // 1. Build Filters (Top)
                ui.filters.innerHTML = '';
                statuses.forEach(s => {
                    const btn = document.createElement('button');
                    btn.className = `chip ${s === activeStatus ? 'selected' : ''}`;
                    // Format: fully-qualified -> Fully Qualified
                    btn.textContent = s.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                    btn.onclick = () => changeStatus(s);
                    ui.filters.appendChild(btn);
                });

                renderMainContent();
            }

            function changeStatus(status) {
                activeStatus = status;
                Array.from(ui.filters.children).forEach(c => {
                    c.classList.toggle('selected', c.textContent.toLowerCase().replace(/ /g, '-') === status);
                });
                renderMainContent();
            }

            function renderMainContent() {
                ui.content.innerHTML = '';
                ui.nav.innerHTML = '';
                ui.main.scrollTop = 0;

                const groups = rawData[activeStatus] || {};
                const groupNames = Object.keys(groups);

                groupNames.forEach((gName, idx) => {
                    // 1. Navigation Item
                    const navItem = document.createElement('div');
                    navItem.className = `nav-item ${idx === 0 ? 'active' : ''}`;
                    navItem.dataset.idx = idx;
                    // Short name: "Smileys & Emotion" -> "Smileys"
                    const shortName = gName.split(' ')[0].replace('&','').trim();
                    navItem.innerHTML = `
                        <div class="nav-icon-box">${shortName.substring(0,2).toUpperCase()}</div>
                        <span class="nav-label">${shortName}</span>
                    `;
                    navItem.onclick = () => scrollToSection(idx);
                    ui.nav.appendChild(navItem);

                    // 2. Content Section
                    const section = document.createElement('section');
                    section.className = 'group-section';
                    section.id = `sec-${idx}`;
                    section.innerHTML = `<div class="group-title">${gName}</div>`;

                    const subgroups = groups[gName];
                    Object.keys(subgroups).forEach(sgName => {
                        const sgTitle = document.createElement('div');
                        sgTitle.className = 'subgroup-pill';
                        sgTitle.textContent = sgName;
                        section.appendChild(sgTitle);

                        const baseMap = subgroups[sgName];
                        
                        // Grid for single items
                        let grid = document.createElement('div');
                        grid.className = 'emoji-grid';
                        let hasGridItems = false;

                        Object.keys(baseMap).forEach(base => {
                            const items = baseMap[base];
                            const baseItems = items.filter(i => !i.qual);
                            const variants = items.filter(i => i.qual);

                            // If we have variants, use a Card container
                            if (items.length > 1 && baseItems.length > 0 && variants.length > 0) {
                                // Close existing grid
                                if (hasGridItems) {
                                    section.appendChild(grid);
                                    grid = document.createElement('div');
                                    grid.className = 'emoji-grid';
                                    hasGridItems = false;
                                }

                                const card = document.createElement('div');
                                card.className = 'variant-card';
                                
                                baseItems.forEach((item, i) => {
                                    card.appendChild(createBtn(item, i === baseItems.length - 1));
                                });
                                variants.forEach(item => {
                                    card.appendChild(createBtn(item, false));
                                });
                                section.appendChild(card);

                            } else {
                                // Add to standard grid
                                hasGridItems = true;
                                items.forEach(item => grid.appendChild(createBtn(item, false)));
                            }
                        });

                        if (hasGridItems) section.appendChild(grid);
                    });

                    ui.content.appendChild(section);
                });

                initScrollSpy(groupNames.length);
            }

            function createBtn(item, isSeparator) {
                const btn = document.createElement('div');
                btn.className = 'emoji-btn' + (isSeparator ? ' separator' : '');
                btn.textContent = item.char;
                
                // Interactions
                btn.onclick = (e) => {
                    e.stopPropagation();
                    copyText(item.char);
                };

                const triggerTip = () => showTooltip(btn, item.base, item.qual);
                
                btn.onmouseenter = triggerTip;
                btn.onmouseleave = hideTooltip;
                btn.ontouchstart = () => triggerTip();
                btn.ontouchend = () => setTimeout(hideTooltip, 1000);

                return btn;
            }

            // --- Actions ---
            function copyText(char) {
                navigator.clipboard.writeText(char).then(() => showSnackbar(`Copied ${char}`))
                .catch(() => {
                    // Fallback
                    const t = document.createElement('textarea');
                    t.value = char; document.body.appendChild(t);
                    t.select(); document.execCommand('copy'); document.body.removeChild(t);
                    showSnackbar(`Copied ${char}`);
                });
            }

            function showSnackbar(msg) {
                ui.snackbar.textContent = msg;
                ui.snackbar.classList.add('visible');
                setTimeout(() => ui.snackbar.classList.remove('visible'), 2500);
            }

            function showTooltip(el, base, qual) {
                if (tooltipTimeout) clearTimeout(tooltipTimeout);
                
                ui.tooltip.innerHTML = `<span class="tt-main">${base}</span>${qual ? '<span class="tt-sub">'+qual+'</span>' : ''}`;
                
                const rect = el.getBoundingClientRect();
                const tipRect = ui.tooltip.getBoundingClientRect();
                const gap = 12;

                // Horizontal Center
                let left = rect.left + (rect.width/2) - (tipRect.width/2);
                // Boundary Check
                left = Math.max(10, Math.min(window.innerWidth - tipRect.width - 10, left));

                // Vertical (Top preferred)
                let top = rect.top - tipRect.height - gap;
                if (top < 10) top = rect.bottom + gap; // Flip to bottom if tight

                ui.tooltip.style.left = `${left}px`;
                ui.tooltip.style.top = `${top}px`;
                ui.tooltip.classList.add('visible');
            }

            function hideTooltip() {
                ui.tooltip.classList.remove('visible');
            }

            // --- Navigation Logic ---
            function scrollToSection(idx) {
                isScrolling = true;
                const target = document.getElementById(`sec-${idx}`);
                
                // Update Nav State
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                const activeBtn = document.querySelector(`.nav-item[data-idx="${idx}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                    activeBtn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                }

                if (target) {
                    // Offset for sticky header (approx 120px)
                    const offset = target.offsetTop - 120;
                    ui.main.scrollTo({ top: offset, behavior: 'smooth' });
                }
                
                setTimeout(() => isScrolling = false, 800);
            }

            function initScrollSpy(count) {
                ui.main.onscroll = () => {
                    if (isScrolling) return;
                    
                    let activeIdx = 0;
                    const scrollY = ui.main.scrollTop + 180; // Offset trigger

                    for (let i = 0; i < count; i++) {
                        const el = document.getElementById(`sec-${i}`);
                        if (el.offsetTop <= scrollY) activeIdx = i;
                        else break;
                    }

                    document.querySelectorAll('.nav-item').forEach((n, i) => {
                        const isActive = i === activeIdx;
                        n.classList.toggle('active', isActive);
                        if (isActive) {
                            n.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                        }
                    });
                };
            }

            // Start
            init();

        })();
    </script>
</body>
</html>
